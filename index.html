<!DOCTYPE html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Garvetur Luxury Porto — Mapa (Pesquisa por nome + Filtro por Ano)</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    :root { --panel:#ffffff; --shadow:0 6px 24px rgba(0,0,0,.12); --radius:12px; --brand:#bfa06a; --dark:#111; }
    html, body { height:100%; margin:0; background:#f5efe6 }
    #map { position:absolute; inset:0 }
    .controls { position:absolute; top:12px; left:12px; z-index:1000; background:var(--panel); padding:12px; border-radius:var(--radius); box-shadow:var(--shadow); font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial; max-width:560px; border:1px solid #eee }
    .controls strong { color:var(--dark) }
    .controls label { display:block; font-size:12px; margin-top:8px }
    .controls input, .controls select, .controls textarea { width:100%; padding:6px 8px; border:1px solid #ddd; border-radius:8px; font-size:12px }
    .controls button { margin-top:8px; padding:8px 10px; border:0; border-radius:10px; cursor:pointer; background:#111; color:#fff }
    .toolbar { position:absolute; right:12px; top:12px; z-index:1000; display:flex; gap:8px; flex-wrap:wrap }
    .toolbar button { background:#fff; border:1px solid #eee; border-radius:10px; padding:8px 10px; box-shadow:var(--shadow); cursor:pointer }
    .legend { position:absolute; right:12px; bottom:12px; z-index:1000; background:#fff; border:1px solid #eee; border-radius:12px; box-shadow:var(--shadow); padding:10px; font-family:system-ui; font-size:12px }
    .chip { display:inline-flex; align-items:center; gap:6px; border:1px solid #eee; border-radius:999px; padding:4px 8px; margin-right:6px; background:#fff }
    .dot { width:10px; height:10px; border-radius:50% }
    .tt { background: rgba(255,255,255,0.92); color:#111; border:1px solid #ddd; border-radius:8px; box-shadow:0 3px 12px rgba(0,0,0,.12); padding:6px 8px; }
    .freg-label { background: rgba(255,255,255,0.85); border-radius: 6px; padding: 2px 6px; border: 1px solid #ddd; font-weight: 600 }
    .row { display:flex; gap:8px; align-items:center }
    .row > * { flex:1 }
  </style>
</head>
<body>
  <div class="controls">
    <strong>Mapa do Porto</strong> — Importa **XLSX, CSV (vírgula ou ;), GeoJSON**.<br/>
    <small>Pesquisa por <strong>Nome</strong> e filtro por <strong>AnoConclusao</strong>. Etiquetas fixas mostram <em>Nome + Notas + Estado + Ano</em>.</small>

    <div class="row" style="margin-top:8px">
      <div style="flex:2">
        <label>Pesquisar empreendimento (Nome)</label>
        <input id="searchName" list="namesList" placeholder="Escreva e selecione — ex.: Menéres 777" />
        <datalist id="namesList"></datalist>
      </div>
      <div style="flex:1">
        <label>Filtrar por AnoConclusao</label>
        <select id="yearFilter">
          <option value="">— Todos —</option>
        </select>
      </div>
      <div style="flex:0">
        <button id="btnSearch">Ir</button>
      </div>
    </div>

    <label>Importar ficheiro (XLSX / CSV / GeoJSON)</label>
    <input type="file" id="fileInput" accept=".xlsx,.xls,.csv,.geojson,.json" />

    <div class="row">
      <div>
        <label>Estado (para adicionar manualmente)</label>
        <select id="pinStatus">
          <option value="licenciado">Licenciado</option>
          <option value="em_construcao" selected>Em construção</option>
          <option value="concluido">Concluído</option>
        </select>
      </div>
      <div>
        <label>Nome</label><input id="pinName" placeholder="Ex.: Empreendimento" />
      </div>
    </div>
    <label>Notas</label><textarea id="pinNotes" rows="2" placeholder="T2/T3; promotor X"></textarea>
    <div class="row">
      <div><label>AnoConclusao</label><input id="pinYear" type="number" placeholder="2026" /></div>
      <div><label>Link (URL)</label><input id="pinLink" placeholder="https://..." /></div>
      <div><label>TabelaVendas (URL PDF)</label><input id="pinPDF" placeholder="https://.../tabela.pdf" /></div>
    </div>

    <div class="row">
      <button id="enableAdd">Ativar modo “Adicionar Pin”</button>
      <button id="clearPins" style="background:#f3f3f3;color:#111">Limpar pins</button>
    </div>

    <label>Mostrar rótulos de freguesia</label>
    <select id="labelsToggle"><option value="on">Sim</option><option value="off">Não</option></select>
  </div>

  <div class="toolbar">
    <button id="fitBtn">Recentrar</button>
    <button id="switchBase">Alternar base</button>
    <button id="toggleTooltips">Ocultar/Mostrar etiquetas</button>
  </div>

  <div id="map"></div>

  <div class="legend">
    <div class="chip"><span class="dot" style="background:#22a447"></span> Licenciado</div>
    <div class="chip"><span class="dot" style="background:#f39c12"></span> Em construção</div>
    <div class="chip"><span class="dot" style="background:#2e86de"></span> Concluído</div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <!-- JS omitido para brevidade; já contém pesquisa, filtro por ano e tooltips fixos -->
</body>
</html>